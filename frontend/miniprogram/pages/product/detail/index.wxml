<view class="container">
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
  </view>
  
  <view class="error" wx:elif="{{error}}">
    <text>{{error}}</text>
    <button bindtap="loadProductDetail" data-id="{{product.id}}">重试</button>
  </view>
  
  <block wx:elif="{{product}}">
    <!-- 商品图片轮播 -->
    <swiper class="product-swiper" indicator-dots="{{true}}" autoplay="{{true}}" interval="3000" duration="500">
      <swiper-item wx:for="{{product.images}}" wx:key="*this">
        <image src="{{item}}" mode="aspectFill" class="product-image"></image>
      </swiper-item>
    </swiper>
    
    <!-- 商品基本信息 -->
    <view class="product-info">
      <view class="product-name">{{product.name}}</view>
      <view class="product-price">
        <text class="current-price">¥{{selectedVariant ? selectedVariant.price : product.price}}</text>
        <text class="market-price" wx:if="{{product.market_price > 0}}">¥{{product.market_price}}</text>
      </view>
      
      <!-- 商品变体选择 -->
      <view class="variants" wx:if="{{product.variants && product.variants.length > 0}}">
        <view class="section-title">规格</view>
        <view class="variant-list">
          <view 
            wx:for="{{product.variants}}" 
            wx:key="id"
            class="variant-item {{selectedVariant.id === item.id ? 'selected' : ''}}"
            bindtap="selectVariant"
            data-id="{{item.id}}"
          >
            {{item.name}}
          </view>
        </view>
      </view>
      
      <!-- 数量选择 -->
      <view class="quantity-selector">
        <view class="section-title">数量</view>
        <view class="quantity-control">
          <view class="quantity-btn" bindtap="changeQuantity" data-type="minus">-</view>
          <input type="number" value="{{quantity}}" disabled />
          <view class="quantity-btn" bindtap="changeQuantity" data-type="plus">+</view>
        </view>
      </view>
    </view>
    
    <!-- 商品详情 -->
    <view class="product-detail">
      <view class="section-title">商品详情</view>
      <rich-text nodes="{{product.description}}"></rich-text>
    </view>
    
    <!-- 底部操作栏 -->
    <view class="bottom-bar">
      <view class="cart-btn" bindtap="addToCart">加入购物车</view>
      <view class="buy-btn" bindtap="buyNow">立即购买</view>
    </view>
  </block>
</view> 